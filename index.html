<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Arcade Studio</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>

<style>
  /* --- GLOBAL SETTINGS (BUTTER SMOOTH) --- */
  html { scroll-behavior: smooth; overflow-y: auto; }
  body {
    background: #0a0a0c; color: white; font-family: sans-serif;
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh; margin: 0; padding-bottom: 150px; 
    -webkit-overflow-scrolling: touch; 
    background-image: linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px);
    background-size: 100% 4px; touch-action: pan-y; overflow-x: hidden;
  }

  /* --- NEON CLOCK --- */
  #arcade-clock {
    margin-top: 15px; font-family: monospace; font-size: 24px; font-weight: bold;
    color: #ff0000; text-shadow: 0 0 10px #ff0000;
    background: rgba(255, 0, 0, 0.05); padding: 5px 15px; border-radius: 4px;
    border: 1px solid rgba(255, 0, 0, 0.3); z-index: 1000;
  }

  /* --- NAVIGATION --- */
  .menu-toggle { position: fixed; top: 15px; left: 15px; background: #1a1a1c; color: #fff; border: 1px solid rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 4px; font-weight: bold; cursor: pointer; z-index: 100000; }
  #view-toggle { position: fixed; top: 15px; right: 15px; background: #1a1a1c; border: 1px solid #00ffff; padding: 8px 12px; border-radius: 4px; z-index: 100000; cursor: pointer; }

  #menu-panel { 
    position: fixed; top: 0; left: -260px; width: 240px; height: 100%; 
    background: #1a1a1c; padding-top: 60px; transition: 0.3s ease; 
    z-index: 99999; display: flex; flex-direction: column; gap: 12px; 
    padding-left: 15px; padding-right: 15px; box-sizing: border-box; padding-bottom: 20px; 
    box-shadow: 2px 0 15px rgba(0,0,0,0.5);
  }
  #menu-panel.open { left: 0; }

  .menu-section { border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.03); border-radius: 6px; padding: 10px; display: flex; flex-direction: column; gap: 5px; }
  .menu-lbl { font-size: 10px; font-weight: 900; color: #00ffff; text-transform: uppercase; }

  #switch-btn { background: rgba(255,255,255,0.05); color: white; border: 2px solid #ff0000; padding: 10px; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 11px; width: 100%; text-align: center; }
  #switch-menu { position: absolute; top: 45px; left: 0; background: #1a1a1c; border: 1px solid #ff0000; border-radius: 8px; width: 100%; display: none; flex-direction: column; z-index: 100001; }
  #switch-menu button { background: transparent; color: #aaa; border: none; padding: 12px; text-align: left; font-size: 11px; cursor: pointer; border-bottom: 1px solid rgba(255,255,255,0.05); }

  .lnk { display: flex; align-items: center; gap: 10px; padding: 12px; text-decoration: none; color: white; font-size: 13px; font-weight: bold; border-radius: 4px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); }
  .lnk svg { width: 18px; height: 18px; fill: white; }
  .designed-by { margin-top: auto; padding: 15px 0; border-top: 1px solid rgba(255,255,255,0.1); text-align: center; font-size: 11px; color: #888; text-transform: uppercase; }
  .designed-by b { color: #ff0000; }

  /* --- HEADERS --- */
  h1 { color: #fff; margin: 20px 0 0 0; font-family: "Arial Black", sans-serif; font-style: italic; font-size: 36px; text-shadow: 2px 2px 0px #ff0000; animation: arcadeBounce 1.8s infinite ease-in-out; }
  @keyframes arcadeBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
  .sub { font-weight: bold; margin-bottom: 15px; font-size: 11px; letter-spacing: 2px; text-align: center; }
  
  .studio-sec { display: none; width: 320px; flex-direction: column; align-items: center; }
  .active-sec { display: flex; }

  /* --- FRAME STUDIO (CHECKERED BG & ANIMATED LED) --- */
  @keyframes rotate { 100% { transform: rotate(360deg); } }
  .stage { position: relative; width: 320px; height: 320px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; }
  .led-ring { position: absolute; inset: -10px; border-radius: 50%; background: conic-gradient(from 0deg, #ff0000, #ff5500, #00ffff, #ff0000); animation: rotate 2.5s linear infinite; filter: blur(12px); z-index: 1; }
  
  #box { 
    position: relative; width: 310px; height: 310px; border-radius: 50%; overflow: hidden; 
    border: 3.5px solid #ff0000; box-sizing: border-box; 
    background-image: linear-gradient(45deg, #111 25%, transparent 25%), linear-gradient(-45deg, #111 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #111 75%), linear-gradient(-45deg, transparent 75%, #111 75%);
    background-color: #050505; background-size: 20px 20px; background-position: center center;
    z-index: 10; flex-shrink: 0; box-shadow: inset 0 0 20px #000;
  }
  canvas#c { width: 310px; height: 310px; touch-action: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 15; }
  .ui { margin-top: 20px; width: 310px; display: flex; flex-direction: column; gap: 6px; }
  .btn { background: #111; border: 2px solid #ffffff; color: white; padding: 10px; text-align: center; border-radius: 8px; font-weight: bold; font-size: 12px; cursor: pointer; width: 100%; box-sizing: border-box; text-transform: uppercase; }
  .btn-r { border-color: #ff0000; }
  .btn:disabled { opacity: 0.3; cursor: not-allowed; border-color: #555; color: #555; }
  .lbl { font-size: 9px; color: #888; text-transform: uppercase; display: flex; justify-content: space-between; width: 100%; margin-top: 5px; }
  .val-tag { color: #ff0000; font-weight: bold; }

  /* --- GIF STUDIO (85% MASK FIXED) --- */
  .viewport { position: relative; z-index: 5; width: 270px; height: 270px; border-radius: 50%; overflow: hidden; background: #000; display: flex; justify-content: center; align-items: center; box-shadow: inset 0 0 30px #000; border: 2px solid rgba(255,255,255,0.05); }
  #v { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); will-change: transform; pointer-events: none; }
  #o { width: 100%; height: 100%; object-fit: contain; display: none; }
  
  .ui-gif { z-index: 10; background: rgba(10, 10, 10, 0.95); padding: 25px; border-radius: 30px; width: 340px; border: 1px solid rgba(255,255,255,0.1); box-sizing: border-box; display:flex; flex-direction:column; align-items:center; margin-bottom:20px; }
  .btn-upload { background: linear-gradient(90deg, #00f3ff, #bc13fe); color: #000; border: none; padding: 15px; border-radius: 50px; font-weight: 800; cursor: pointer; width: 100%; margin-bottom: 15px; }
  .neon-wrap { position: relative; display: block; margin-top: 15px; padding: 3px; border-radius: 50px; overflow: hidden; width: 100%; }
  .neon-wrap.blue::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient(transparent, transparent, #00f3ff, #bc13fe, #ff0055, #00f3ff, transparent, transparent); animation: rotate 3s linear infinite; z-index: 0; }
  .btn-inner { position: relative; display: block; text-align: center; color: white; background: #000; padding: 12px; border-radius: 48px; font-weight: 900; z-index: 1; cursor: pointer; width: 100%; border: none; font-size: 14px; }

  /* --- RED & CYAN GRADIENT SLIDERS (CIRCLE HANDLE) --- */
  input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; margin: 15px 0; cursor: pointer; }
  input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 10px; background: linear-gradient(to right, #ff0000, #00ffff); border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); }
  input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 26px; width: 26px; border-radius: 50%; background: #ffffff; margin-top: -9px; border: 3px solid #ff0000; box-shadow: 0 0 15px #ff0000; transition: 0.2s; }
  input[type=range]:active::-webkit-slider-thumb { transform: scale(1.2); box-shadow: 0 0 25px #ff0000; }
  
  .ui-gif input[type=range]::-webkit-slider-runnable-track { background: linear-gradient(to right, #00ffff, #ff0055); }
  .ui-gif input[type=range]::-webkit-slider-thumb { border-color: #00ffff; box-shadow: 0 0 15px #00ffff; }

  /* --- FONTS & SYMBOLS --- */
  .font-input { width: 100%; background: #111; border: 2px solid #00ffff; color: #fff; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 15px; outline: none; box-sizing: border-box; }
  .font-scroll { width: 100%; max-height: 400px; overflow-y: auto; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; box-sizing: border-box; }
  .font-item { background: #1a1a1c; border-bottom: 1px solid rgba(255,255,255,0.1); padding: 16px; text-align: center; cursor: pointer; white-space: pre-wrap; font-size: 20px; }
  .sym-grid { display: flex; flex-wrap: wrap; gap: 5px; padding: 10px; }
  .sym-btn { background: #1a1a1c; border: 1px solid #333; color: white; padding: 15px 0; font-size: 20px; border-radius: 6px; cursor: pointer; flex: 1 0 18%; text-align: center; }

  input[type=file], #yt-player { display: none; }
</style>
</head>
<body onclick="if(!audioStarted) initAudio()">

<div id="arcade-clock">00:00:00</div>

<button class="menu-toggle" onclick="toggleMenu(event)">MENU ‚ò∞</button>
<button id="view-toggle" onclick="toggleViewMode()">üñ•Ô∏è</button>

<div id="menu-panel">
  <div class="menu-section">
    <div class="menu-lbl">Studio Selection</div>
    <div class="switch-container">
      <button id="switch-btn" onclick="toggleSwitchMenu(event)">SELECT TOOL üìÇ</button>
      <div id="switch-menu">
        <button onclick="changeStudio('frame')">üñºÔ∏è Frame Studio</button>
        <button onclick="changeStudio('font')">‚úçÔ∏è Font Generator</button>
        <button onclick="changeStudio('gif')">‚ö° GIF Maker</button>
        <button onclick="changeStudio('sym')">‚ú® Symbols Studio</button>
      </div>
    </div>
  </div>

  <div class="menu-section">
    <div class="menu-lbl">Music Player</div>
    <div onclick="toggleMusic()" style="display:flex; justify-content:space-between; font-size:12px; cursor:pointer;">
      <span>POWER</span> <span id="m-status" style="color:#ff0000;">ON</span>
    </div>
    <select id="track-select" style="width:100%; margin-top:5px; background:#222; color:white; border:1px solid #444;" onchange="changeMusic(this.value)">
      <option value="jfKfPfyJRdk">‚òï Lofi Focus</option>
      <option value="nv_2rz5BFDA">üïπÔ∏è Retro Wave</option>
    </select>
  </div>

  <a href="https://discord.gg/ardc" target="_blank" class="lnk" style="border-color:#5865F2; margin-top:15px;">
    <svg viewBox="0 0 127.14 96.36"><path d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.11,77.11,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22c2.36-24.44-5.42-48.18-18.9-72.15ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/></svg>
    <span>Discord Server</span>
  </a>

  <div class="designed-by">DESIGNED BY <b>RISK</b></div>
</div>

<div id="yt-player"></div>

<h1 id="studio-name">ARCADE</h1>
<p class="sub" id="studio-sub">FRAME STUDIO</p>

<div id="frame-studio" class="studio-sec active-sec">
  <div class="stage">
    <div class="led-ring"></div>
    <div id="box"><canvas id="c" width="800" height="800"></canvas></div>
  </div>
  <div class="ui">
    <label class="btn">CHOOSE IMAGE<input type="file" id="u1" accept="image/*" onchange="handleFile(event)"></label>
    <label class="btn btn-r">APPLY FRAME<input type="file" id="u2" accept="image/*" onchange="handleFrame(event)"></label>
    <button class="btn" style="border-color:#00ffff; color:#00ffff;" onclick="centerSubject()">CENTER SUBJECT üéØ</button>
    <button class="btn" style="border-color:#ff0000; color:#ff0000;" onclick="resetProject()">RESET PROJECT ‚Üª</button>
    <div class="lbl">ZOOM <span id="z-val" class="val-tag">100%</span></div>
    <input type="range" id="z" min="0.1" max="4" step="0.01" value="1" oninput="updateZ(this.value)">
    <div class="lbl">ROTATE <span id="r-val" class="val-tag">0¬∞</span></div>
    <input type="range" id="r" min="0" max="360" step="1" value="0" oninput="updateR(this.value)">
    <button id="save" class="btn" onclick="downloadPic()" disabled>DOWNLOAD PICTURE</button>
  </div>
</div>

<div id="font-studio" class="studio-sec">
  <input type="text" id="font-input" class="font-input" placeholder="Type text here..." oninput="genFonts()">
  <div class="lbl" style="text-align:right; margin-bottom:5px; color:#555;">38 Styles</div>
  <div id="font-results" class="font-scroll"></div>
</div>

<div id="gif-studio" class="studio-sec">
    <div class="stage" id="stage">
        <div class="led-ring"></div>
        <div class="viewport" id="vp">
            <video id="v" muted playsinline loop></video>
            <img id="o">
        </div>
    </div>
    <div class="ui-gif">
        <button class="btn-upload" onclick="document.getElementById('gfInput').click()">UPLOAD VIDEO</button>
        <input type="file" id="gfInput" accept="video/*" style="display:none">
        
        <div class="lbl" style="width:100%">ZOOM / SCALE <span id="zv" class="val-tag">100%</span></div>
        <input type="range" id="zoom" min="1" max="3" step="0.01" value="1" oninput="updateGifZ(this.value)">
        
        <div class="lbl" style="width:100%">SPEED <span id="sv" class="val-tag">1.0x</span></div>
        <input type="range" id="speed" min="0.5" max="3.0" step="0.1" value="1.0" oninput="updateGifS(this.value)">
        
        <div class="neon-wrap blue"><button id="go" class="btn-inner" onclick="processGif()">‚ö° CREATE HD GIF</button></div>
        <button class="btn" style="border-color:#00ffff; color:#00ffff; margin-top:10px;" onclick="centerGif()">CENTER SUBJECT üéØ</button>
        
        <div id="msg" style="text-align:center; font-size:11px; color:#00ffff; margin-top:5px;">Ready</div>
        <div id="dlBox" class="neon-wrap blue" style="display:none; margin-top:10px;">
            <a id="dl" class="btn-inner">‚¨áÔ∏è DOWNLOAD GIF</a>
            <button class="btn-inner" style="background:#222; margin-top:5px;" onclick="location.reload()">RESET PROJECT ‚Üª</button>
        </div>
    </div>
</div>

<div id="sym-studio" class="studio-sec">
    <input type="text" id="sym-box" class="font-input" placeholder="Build your bio here...">
    <div id="sym-container" class="font-scroll"></div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
const c=document.getElementById('c'),x=c.getContext('2d'),zSl=document.getElementById('z'),rSl=document.getElementById('r'),panel=document.getElementById('menu-panel'),mStat=document.getElementById('m-status'), sName=document.getElementById('studio-name'), sSub=document.getElementById('studio-sub'), swMenu=document.getElementById('switch-menu');
const zVal=document.getElementById('z-val'),rVal=document.getElementById('r-val');
let i=new Image(),f=new Image(),cfg={s:1,m:375,x:400,y:400,r:0},player,musicOn=true,audioStarted=false;

// --- CLOCK ---
function updateClock(){ document.getElementById('arcade-clock').innerText = new Date().toTimeString().split(' ')[0]; }
setInterval(updateClock, 1000); updateClock();

// --- MUSIC ---
function initAudio(){ if(!audioStarted){ audioStarted=true; if(player&&musicOn){ player.unMute(); player.playVideo(); }}}
function onYouTubeIframeAPIReady(){ player=new YT.Player('yt-player',{height:'0',width:'0',videoId:'jfKfPfyJRdk',playerVars:{'autoplay':1,'loop':1,'playlist':'jfKfPfyJRdk'},events:{'onReady':e=>{e.target.setVolume(25);}}});}
function changeMusic(id){ if(player)player.loadVideoById(id); }
function toggleMusic(){ initAudio(); musicOn=!musicOn; if(musicOn){ player.playVideo(); mStat.innerText="ON"; mStat.style.color="#ff0000"; }else{ player.pauseVideo(); mStat.innerText="OFF"; mStat.style.color="#888"; }}

// --- FONTS ---
const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
const alphas = [{m:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"},{m:"ùêÄùêÅùêÇùêÉùêÑùêÖùêÜùêáùêàùêâùêäùêãùêåùêçùêéùêèùêêùêëùêíùêìùêîùêïùêñùêóùêòùêôùêöùêõùêúùêùùêûùêüùê†ùê°ùê¢ùê£ùê§ùê•ùê¶ùêßùê®ùê©ùê™ùê´ùê¨ùê≠ùêÆùêØùê∞ùê±ùê≤ùê≥ùüéùüèùüêùüëùüíùüìùüîùüïùüñùüó"},{m:"ùê¥ùêµùê∂ùê∑ùê∏ùêπùê∫ùêªùêºùêΩÔº´Ôº¨Ôº≠ùëÅùëÇùëÉùëÑùëÖùëÜùëáùëà‚ìãùëäùëãùëåùëçùëéùëèÔΩÉÔΩÑÔΩÖÔΩÜÔΩáÔΩàÔΩâùëóÔΩãÔΩåÔΩçÔΩéÔΩèÔΩêùëûùëüùë†ùë°ùë¢ùë£ùë§ùë•ÔΩôÔΩö0123456789"},{m:"ùë®ùë©ùë™ùë´ùë¨ùë≠ùëÆùëØùë∞ùë±ùë≤ùë≥ùë¥ùëµùë∂ùë∑ùë∏ùëπùë∫ùëªùëº‚ìãùëæùëøùíÄùíÅùíÇùíÉùíÑùíÖùíÜùíáùíàùíâùíäùíãùíåùíçùíéùíèùíêùíëùííùíìùíîùíïùíñùíóùíòùíôùíöùíõùüéùüèùüêùüëùüíùüìùüîùüïùüñùüó"},{m:"ùíú‚Ñ¨ùíûùíü‚Ñ∞‚Ñ±ùí¢‚Ñã‚Ñêùí•ùí¶‚Ñí‚Ñ≥‚í©‚í™‚í´‚í¨‚ÑõùíÆùíØùí∞‚ìãùí≤ùí≥ùí¥ùíµùí∂ùí∑ùí∏ùíπ‚ÑØùíª‚ÑäùíΩùíæùíøùìÄùìÅùìÇùìÉ‚Ñ¥ùìÖùìÜùìáùìàùìâùíñ‚ìãùìåùìçùìéùìè0123456789"},{m:"ùìêùìëùìíùììùìîùìïùìñùìóùìòùìôùìöùìõùìúùìùùìûùìüùì†ùì°ùì¢ùì£ùì§‚ìãùì¶ùìßùì®ùì©ùì™ùì´ùì¨ùì≠ùìÆùìØùì∞ùì±ùì≤ùì≥ùì¥ùìµùì∂ùì∑ùì∏ùìπùì∫ùìªùìºùìΩùìæìãºùîÄùîÅùîÇùîÉ0123456789"},{m:"ùñ†ùñ°ùñ¢ùñ£ùñ§ùñ•ùñ¶ùñßùñ®ùñ©ùñ™ùñ´ùñ¨ùñ≠ùñÆùñØùñ∞ùñ±ùñ≤ùñ≥ùñ¥‚ìãùñÇùñÉùñÑùñÖùñ∫ùñªùñºùñΩùñæùñøùóÄùóÅùóÇùóÉùóÑùóÖùóÜùóáùóàùóâùóäùóãùóåùóçùóé‚ìãùóêùóëùóíùóìùü¢ùü£ùü§ùü•ùü¶ùüßùü®ùü©ùü™ùü´"},{m:"ùóîùóïÔº£ùóóùóòùóôùóöÔº®Ôº©Ôº™Ôº´Ôº¨Ôº≠ÔºÆÔºØÔº∞ùó§ùó•ùó¶Ôº¥ùó®‚ìãùó™ùó´Ôºπùó≠ùóÆùóØÔΩÉÔΩÑÔΩÖÔΩÜÔΩáùóµÔΩâùëóÔΩãÔΩåÔΩçÔΩéÔΩèÔΩêùóæÔΩíÔΩìÔΩîÔΩïÔΩñÔΩóùòÖÔΩôÔΩöùü¨ùü≠ùüÆùüØùü∞ùü±ùü≤ùü≥ùü¥ùüµ"},{m:"ùî∏ùîπ‚ÑÇùîªùîºùîΩùîæ‚ÑçùïÄùïÅùïÇùïÉùïÑ‚ÑïùïÜ‚Ñô‚Ñö‚Ñùùïäùïãùïåùïçùïéùïèùïê‚Ñ§ùïíùïìùïîùïïùïñùïóùïòùïôÔΩâùëóÔΩãÔΩåÔΩçÔΩéÔΩèÔΩêùï¢ÔΩíÔΩìÔΩîÔΩïìãºùï®ùï©ùï™ùï´ùüòùüôùüöùüõùüúùüùùüûùüüùü†ùü°"},{m:"ùîÑùîÖ‚Ñ≠ùîáùîàùîâùîä‚Ñå‚Ñëùîçùîéùîèùîêùîëùîíùîìùîî‚Ñúùîñùîóùîòùîôùîöùîõùîú‚Ñ®ùîûùîüùî†ùî°ùî¢ùî£ùî§ÔΩàÔΩâùëóÔΩãÔΩåÔΩçÔΩéÔΩèÔΩêùîÆÔΩíÔΩìÔΩîÔΩïìãºùî¥ùîµùî∂ùî∑0123456789"}];
function genFonts(){
  const v=document.getElementById('font-input').value, b=document.getElementById('font-results'); b.innerHTML=""; if(!v) return;
  alphas.forEach(a => {
    let t = ""; const m = Array.from(a.m);
    for(let ch of v){ let idx = chars.indexOf(ch); t += (idx !== -1 && m[idx]) ? m[idx] : ch; }
    let d=document.createElement('div'); d.className="font-item"; d.innerText=t; d.onclick=()=>{navigator.clipboard.writeText(t);}; b.appendChild(d);
  });
}

function renderSymbols(){
    const b = document.getElementById('sym-container'); b.innerHTML = "";
    const s = { "Hearts": ["‚ù§","‚ù•","‚ô°","‚ô•","‚ù¶","‚ùß","‚ù£","üíû","üíó","üíï","üíò","üíù","üíü","üíå","üíã"], "Stars": ["‚ú®","‚òÖ","‚òÜ","‚ú°","‚ú¶","‚úß","‚ú©","‚ú™","‚ú´","‚ú¨","‚ú≠","‚úÆ","‚úØ","‚ú∞","‚ÅÇ","‚ùÑ","‚ùÖ","‚ùÜ"], "Dice": ["üé≤","‚öÄ","‚öÅ","‚öÇ","‚öÉ","‚öÑ","‚öÖ"], "Arrows": ["‚Üê","‚Üë","‚Üí","‚Üì","‚Üî","‚Üï","‚Ü∫","‚Üª","‚Üñ","‚Üó","‚Üò","‚Üô"] };
    for (const [c, y] of Object.entries(s)) {
        let t = document.createElement('div'); t.className = "cat-title"; t.innerText = c; b.appendChild(t);
        let g = document.createElement('div'); g.className = "sym-grid";
        y.forEach(sym => { let n = document.createElement('div'); n.className = "sym-btn"; n.innerText = sym; n.onclick = () => { document.getElementById('sym-box').value += sym; }; g.appendChild(n); }); b.appendChild(g);
    }
}
renderSymbols();

// --- GIF ENGINE (INSTANT CROP) ---
const wB = new Blob([`importScripts('https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js');`], { type: 'application/javascript' });
const wU = URL.createObjectURL(wB);
const gfI=document.getElementById('gfInput'), v=document.getElementById('v'), o=document.getElementById('o'), go=document.getElementById('go'), msg=document.getElementById('msg');
let gX=0, gY=0, gifS=1;

gfI.onchange=(e)=>{ 
    const f=e.target.files[0]; if(!f)return; 
    v.style.display='block'; o.style.display='none'; 
    v.src=URL.createObjectURL(f); 
    v.onloadedmetadata=()=>{
        gifS = Math.max(270/v.videoWidth, 270/v.videoHeight);
        document.getElementById('zoom').min = gifS;
        document.getElementById('zoom').value = gifS;
        updateGifTransform();
        v.play();
    };
};

function centerGif() { gX = 0; gY = 0; updateGifTransform(); }

function processGif() {
  if(!v.src) return; 
  go.disabled=true; msg.innerText="Processing...";
  const gif=new GIF({workers:2, quality:10, width:480, height:480, workerScript:wU});
  const can=document.createElement('canvas'); can.width=480; can.height=480; const ctx=can.getContext('2d');
  let cT=0; const fps=15;
  const cap=()=>{ if(cT>=v.duration){ msg.innerText="Encoding..."; gif.render(); return; } v.currentTime=cT; };
  v.onseeked=()=>{ 
      const scale = parseFloat(document.getElementById('zoom').value);
      const sWidth = v.videoWidth / (scale * (480/270));
      const sHeight = v.videoHeight / (scale * (480/270));
      const sx = (v.videoWidth - sWidth)/2 - (gX * (v.videoWidth/270) / scale);
      const sy = (v.videoHeight - sHeight)/2 - (gY * (v.videoHeight/270) / scale);
      ctx.fillStyle='#000'; ctx.fillRect(0,0,480,480);
      ctx.drawImage(v, sx, sy, sWidth, sHeight, 0, 0, 480, 480);
      gif.addFrame(ctx,{copy:true, delay:1000/fps}); 
      cT+=(1/fps); setTimeout(cap, 10); 
  };
  gif.on('finished', b=>{ 
      const url=URL.createObjectURL(b); v.style.display='none'; o.src=url; o.style.display='block'; 
      document.getElementById('dl').href=url; document.getElementById('dlBox').style.display='block'; 
      msg.innerText="Ready"; go.disabled=false;
  });
  cap();
}

function updateGifZ(val) { document.getElementById('zv').innerText = Math.round(val*100) + '%'; gifS=parseFloat(val); updateGifTransform(); }
function updateGifS(val) { document.getElementById('sv').innerText = val + 'x'; v.playbackRate = parseFloat(val); }

function updateGifTransform() {
    if(!v.src) return;
    const aspect = v.videoWidth / v.videoHeight;
    let baseW, baseH;
    if(aspect > 1) { baseH=270; baseW=270*aspect; } else { baseW=270; baseH=270/aspect; }
    const curW = baseW * gifS, curH = baseH * gifS;
    const maxX = Math.max(0, (curW - 270) / 2), maxY = Math.max(0, (curH - 270) / 2);
    gX = Math.max(-maxX, Math.min(maxX, gX));
    gY = Math.max(-maxY, Math.min(maxY, gY));
    v.style.transform = `translate(calc(-50% + ${gX}px), calc(-50% + ${gY}px)) scale(${gifS})`;
}

// --- GIF FINGER DRAG ---
const vp = document.getElementById('vp');
let isDrag=false, sX, sY, iX, iY;
vp.addEventListener('mousedown', e => { if(!v.src) return; isDrag=true; sX=e.clientX; sY=e.clientY; iX=gX; iY=gY; });
vp.addEventListener('touchstart', e => { if(!v.src) return; isDrag=true; sX=e.touches[0].clientX; sY=e.touches[0].clientY; iX=gX; iY=gY; }, {passive:false});
window.addEventListener('mousemove', e => { if(!isDrag) return; gX=iX+(e.clientX-sX); gY=iY+(e.clientY-sY); updateGifTransform(); });
window.addEventListener('touchmove', e => { if(!isDrag) return; e.preventDefault(); gX=iX+(e.touches[0].clientX-sX); gY=iY+(e.touches[0].clientY-sY); updateGifTransform(); }, {passive:false});
window.addEventListener('mouseup', () => isDrag=false);
window.addEventListener('touchend', () => isDrag=false);

// --- FRAME ENGINE (LOCK LOGIC) ---
function d(){ 
  x.clearRect(0,0,800,800); 
  if(i.src) {
     let w=i.width*cfg.s, h=i.height*cfg.s;
     let minS = 760 / Math.min(i.width, i.height);
     if(cfg.s < minS) { cfg.s = minS; w=i.width*cfg.s; h=i.height*cfg.s; zSl.value=cfg.s; }
     let mX = (w - 750) / 2, mY = (h - 750) / 2;
     cfg.x = Math.max(400-mX, Math.min(400+mX, cfg.x));
     cfg.y = Math.max(400-mY, Math.min(400+mY, cfg.y));
  }
  x.save(); x.beginPath(); x.arc(400,400,375,0,6.28); x.clip(); 
  if(i.src){ x.save(); x.translate(cfg.x,cfg.y); x.rotate(cfg.r*Math.PI/180); x.drawImage(i,-i.width*cfg.s/2,-i.height*cfg.s/2,i.width*cfg.s,i.height*cfg.s); x.restore(); } 
  x.restore(); if(f.src) x.drawImage(f,0,0,800,800); 
}
function handleFile(e){ let r=new FileReader(); r.onload=val=>{ let n=new Image(); n.onload=()=>{ i=n; cfg.s=Math.max(800/i.width, 800/i.height); cfg.x=400; cfg.y=400; cfg.r=0; zSl.min=cfg.s; zSl.value=cfg.s; d(); document.getElementById('save').disabled=false; }; n.src=val.target.result; }; r.readAsDataURL(e.target.files[0]); }
function handleFrame(e){ let r=new FileReader(); r.onload=val=>{ let n=new Image(); n.onload=()=>{f=n; d();}; n.src=val.target.result; }; r.readAsDataURL(e.target.files[0]); }
function updateZ(val){ cfg.s=parseFloat(val); d(); }
function updateR(val){ cfg.r=parseInt(val); d(); }
function centerSubject(){ cfg.x=400; cfg.y=400; cfg.r=0; d(); }
function resetProject(){ location.reload(); }
function downloadPic(){ d(); let a=document.createElement('a'); a.download=`Arcade_${Date.now()}.png`; a.href=c.toDataURL(); a.click(); }

// --- MULTI-TOUCH ---
let iD=0, iA=0, sS=1, sR=0, isP=false, tStart={x:0,y:0};
c.addEventListener('touchstart', e => { if(e.touches.length === 1) { isP=true; tStart={x:e.touches[0].clientX, y:e.touches[0].clientY}; } if(e.touches.length === 2) { let dx=e.touches[0].clientX-e.touches[1].clientX, dy=e.touches[0].clientY-e.touches[1].clientY; iD = Math.hypot(dx, dy); iA = Math.atan2(dy, dx); sS = cfg.s; sR = cfg.r; }}, {passive:false});
c.addEventListener('touchmove', e => { e.preventDefault(); if(e.touches.length === 1 && isP) { cfg.x += (e.touches[0].clientX - tStart.x) * (800/310); cfg.y += (e.touches[0].clientY - tStart.y) * (800/310); tStart={x:e.touches[0].clientX, y:e.touches[0].clientY}; d(); } if(e.touches.length === 2) { let dx=e.touches[0].clientX-e.touches[1].clientX, dy=e.touches[0].clientY-e.touches[1].clientY; let dist = Math.hypot(dx, dy), ang = Math.atan2(dy, dx); cfg.s = sS * (dist / iD); zSl.value = cfg.s; cfg.r = sR + (ang - iA) * (180/Math.PI); rSl.value = cfg.r % 360; d(); }}, {passive:false});
c.addEventListener('touchend', () => isP=false);

// --- HELPERS ---
function toggleMenu(e){ e.stopPropagation(); panel.classList.toggle('open'); }
function toggleSwitchMenu(e){ e.stopPropagation(); swMenu.style.display = swMenu.style.display==='flex'?'none':'flex'; }
function toggleViewMode(){ document.body.classList.toggle('pc-mode'); }
function changeStudio(m) { document.querySelectorAll('.studio-sec').forEach(s => s.classList.remove('active-sec')); document.getElementById(m+'-studio').classList.add('active-sec'); sName.innerText = m==='sym'?'SYMBOLS':m.toUpperCase(); sSub.innerText = m==='frame'?'FRAME STUDIO':m==='font'?'GENERATOR':m==='sym'?'STUDIO':'GIF STUDIO'; panel.classList.remove('open'); }
document.querySelectorAll('input[type=range]').forEach(s => { const u = () => s.style.setProperty('--v', (s.value-s.min)/(s.max-s.min)*100+'%'); s.addEventListener('input', u); u(); });
</script>
</body>
</html>
