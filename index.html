<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Arcade Studio</title>
<style>
  html { scroll-behavior: smooth; }
  body {
    background: #000; color: white; font-family: sans-serif;
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh; margin: 0; padding-bottom: 120px;
    -webkit-overflow-scrolling: touch; transition: 0.5s;
    overflow-x: hidden; position: relative;
    /* OFFICIAL THEME 8 DEFAULT: SCANLINE RETRO */
    background-image: linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px);
    background-size: 100% 4px;
  }
  
  /* THEME DEFINITIONS */
  body.t1 { background-image: linear-gradient(rgba(0, 255, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 255, 0.05) 1px, transparent 1px); background-size: 30px 30px; } 
  body.t2 { background: #1a0033; background-image: radial-gradient(#ff00ff 0.5px, transparent 0.5px); background-size: 20px 20px; }
  body.t3 { background: #001a00; color: #00ff00; }
  body.t4 { background: linear-gradient(45deg, #1a1a1c, #2a2a2e); }
  body.t5 { background: #2b1d0e; background-image: repeating-linear-gradient(45deg, rgba(255,215,0,0.02) 0px, rgba(255,215,0,0.02) 2px, transparent 2px, transparent 10px); }
  body.t6 { background: #000d1a; border-top: 5px solid #00ffff; }
  body.t7 { background: #1a0505; background-image: radial-gradient(#ff4d4d 1px, transparent 0); background-size: 40px 40px; }
  body.t8 { background: #000; background-image: linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px); background-size: 100% 4px; }
  body.t9 { background: #0d0d0d; border-left: 10px solid #00ffff; }
  body.t10 { background: #111; background-image: linear-gradient(30deg, #222 12%, transparent 12.5%, transparent 87%, #222 87.5%, #222), linear-gradient(150deg, #222 12%, transparent 12.5%, transparent 87%, #222 87.5%, #222); background-size: 40px 70px; }
  body.t11 { background: #1e1e2e; }
  body.t12 { background: #000; box-shadow: inset 0 0 100px #ff0000; }
  body.t13 { background: #002b36; }
  body.t14 { background: #111; background-image: linear-gradient(white 0.5px, transparent 0.5px), linear-gradient(90deg, white 0.5px, transparent 0.5px); background-size: 50px 50px; }
  body.t15 { background: #0a0a0a; border-bottom: 8px solid #ff00ff; }
  body.t16 { background: radial-gradient(circle, #222, #000); }
  body.t17 { background: #121212; background-image: linear-gradient(45deg, #1a1a1a 25%, transparent 25%); background-size: 4px 4px; }
  body.t18 { background: #000; border: 2px solid #00ffff; }
  body.t19 { background: #050505; color: #ff0000; }
  body.t20 { background: #1a1a1c; border-right: 5px solid #ff0000; }
  body.t21 { background: #0a0a0c; background-image: none; }

  .menu-toggle { position: absolute; top: 15px; left: 15px; background: #1a1a1c; color: #fff; border: 1px solid rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 4px; font-weight: bold; cursor: pointer; z-index: 1000; font-size: 11px; }

  #menu-panel, #theme-selector { position: fixed; top: 0; left: -250px; width: 230px; height: 100%; background: #000; padding-top: 60px; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 999; display: flex; flex-direction: column; gap: 10px; padding-left: 15px; padding-right: 15px; overflow-y: auto; }
  #menu-panel.open, #theme-selector.open { left: 0; }
  
  .lnk, .music-btn, .theme-opt { display: flex; align-items: center; gap: 10px; padding: 12px; text-decoration: none; color: white; font-size: 13px; font-weight: bold; border-radius: 4px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); cursor: pointer; }
  .music-btn { border-color: #ff0000; background: rgba(255,0,0,0.1); justify-content: space-between; }
  .theme-opt { justify-content: flex-start; margin-bottom: 2px; }
  .theme-opt:hover { background: rgba(255,255,255,0.1); }
  .theme-opt .t-prev { width: 24px; height: 24px; border-radius: 3px; border: 1px solid #fff; flex-shrink: 0; }
  .lnk svg { width: 18px; height: 18px; fill: white; flex-shrink: 0; }

  /* ARCADE BOUNCE ANIMATION */
  h1 { 
    color: #ffffff; margin: 60px 0 0 0; font-family: "Arial Black", sans-serif; font-style: italic; font-size: 36px; 
    text-transform: uppercase; letter-spacing: -1px; text-shadow: 2px 2px 0px #ff0000, -1px -1px 10px rgba(255, 0, 0, 0.8); 
    text-align: center;
    animation: arcadeBounce 1.8s infinite ease-in-out;
  }
  @keyframes arcadeBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  p.sub { color: #ffffff; font-weight: bold; margin: 2px 0 15px 0; text-transform: uppercase; font-size: 11px; letter-spacing: 2px; text-align: center; }

  #box { position: relative; width: 280px; height: 280px; border-radius: 50%; overflow: hidden; background-image: linear-gradient(45deg,#111 25%,transparent 25%),linear-gradient(-45deg,#111 25%,transparent 25%),linear-gradient(45deg,transparent 75%,#111 75%),linear-gradient(-45deg,transparent 75%,#111 75%); background-size: 20px 20px; box-shadow: 0 0 20px rgba(0,0,0,0.5); border: 2px solid transparent; margin: 0 auto; -webkit-mask-image: -webkit-radial-gradient(white,black); }
  canvas { position: absolute; top: 0; left: 0; width: 280px; height: 280px; touch-action: none; }
  
  #shine-flare { position: absolute; top: 0; left: -100%; width: 50%; height: 100%; background: linear-gradient(to right, transparent, rgba(255,255,255,0.4), transparent); transform: skewX(-25deg); pointer-events: none; }
  .shine-active #shine-flare { animation: shineRun 1.5s ease-in-out; }
  @keyframes shineRun { 0% { left: -100%; } 100% { left: 200%; } }

  .ui { margin-top: 20px; width: 260px; display: flex; flex-direction: column; align-items: stretch; gap: 6px; margin-left: auto; margin-right: auto; }
  .btn { background: #111; border: 2px solid #ffffff; color: white; padding: 10px; text-align: center; border-radius: 8px; font-weight: bold; display: block; font-size: 11px; cursor: pointer; }
  .btn-r { border-color: #ff0000; }
  .btn-shine { border-color: #ffd700; color: #ffd700; }
  .btn-center { border-color: #00ffff; color: #00ffff; margin-bottom: 5px; }

  .lbl { font-size: 9px; color: #888; text-transform: uppercase; margin-top: 2px; display: flex; justify-content: space-between; align-items: center; }
  .val-tag { color: #ff0000; font-weight: bold; font-family: monospace; font-size: 10px; }

  input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; margin: 10px 0; cursor: pointer; }
  input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 8px; background: linear-gradient(to right, #ff0000 var(--v, 0%), #00ffff var(--v, 0%)); border-radius: 4px; }
  input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #ff0000; margin-top: -6px; box-shadow: 0 0 10px #ff0000; border: 2px solid #ffffff; }
  
  #save { background: #ff0000; border: none; font-size: 13px; color: white; padding: 12px; border-radius: 8px; font-weight: bold; margin-top: 10px; cursor: not-allowed; opacity: 0.4; transition: 0.2s; }
  #save.active { cursor: pointer; opacity: 1; }

  #about-page { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 2000; overflow-y: auto; padding: 80px 20px; text-align: left; }
  .about-wrap { max-width: 600px; margin: auto; }
  .back-btn { background: #ff0000; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-weight: bold; cursor: pointer; margin-bottom: 30px; }
  .sec-h { color: #00ffff; font-size: 14px; letter-spacing: 2px; border-bottom: 1px solid #222; margin-top: 30px; padding-bottom: 8px; font-weight: bold; text-transform: uppercase; }
  .red-step { color: #ff0000; font-weight: bold; }
  input[type=file] { display: none; }
  #yt-player { display: none; }
</style>
</head>
<body onclick="startAudio()">

<button class="menu-toggle" onclick="toggleMenu(event)">MENU ‚ò∞</button>

<div id="menu-panel">
  <div class="music-btn" onclick="toggleMusic()">MUSIC CONTROL <span id="m-status" style="color:#ff0000;">ON</span></div>
  <div class="lnk" style="border-color:#00ffff;" onclick="openThemeSelector()">
    <svg viewBox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M6.343 6.343l-.707-.707M12 7a5 5 0 100 10 5 5 0 000-10z"/></svg>
    <span>Switch Theme</span>
  </div>
  <a href="https://discord.gg/ardc" target="_blank" class="lnk" style="border-color:#5865F2;" onclick="playShutter()"><svg viewBox="0 0 127.14 96.36"><path d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.11,77.11,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22c2.36-24.44-5.42-48.18-18.9-72.15ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/></svg><span>Discord Server</span></a>
  <a href="https://platopedia.com/groups/arcade" target="_blank" class="lnk" style="border-color:#00ffff;" onclick="playShutter()"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg><span>Arcade Website</span></a>
  <div class="lnk" style="border-color:#ffffff;" onclick="toggleAboutPage()"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg><span>About Us</span></div>
</div>

<div id="theme-selector">
  <div class="music-btn" onclick="closeThemeSelector()" style="border-color:#555;">‚Üê BACK TO MENU</div>
  <div class="theme-opt" onclick="setT(8)"><div class="t-prev" style="background:#000; border-top: 4px solid #333;"></div> Official Scanline</div>
  <div class="theme-opt" onclick="setT(1)"><div class="t-prev" style="background: repeating-linear-gradient(90deg, #0af 0 1px, transparent 0 5px)"></div> Neon Grid</div>
  <div class="theme-opt" onclick="setT(2)"><div class="t-prev" style="background:#1a0033;"></div> Vaporwave</div>
  <div class="theme-opt" onclick="setT(3)"><div class="t-prev" style="background:#001a00;"></div> Matrix Noir</div>
  <div class="theme-opt" onclick="setT(4)"><div class="t-prev" style="background:#2a2a2e;"></div> Carbon Fiber</div>
  <div class="theme-opt" onclick="setT(5)"><div class="t-prev" style="background:#2b1d0e;"></div> Gold Rush</div>
  <div class="theme-opt" onclick="setT(6)"><div class="t-prev" style="background:#000d1a;"></div> Deep Ocean</div>
  <div class="theme-opt" onclick="setT(7)"><div class="t-prev" style="background:#1a0505;"></div> Blood Moon</div>
  <div class="theme-opt" onclick="setT(9)"><div class="t-prev" style="background:#00ffff;"></div> Cyber Side</div>
  <div class="theme-opt" onclick="setT(10)"><div class="t-prev" style="background:#222;"></div> Hexagon</div>
  <div class="theme-opt" onclick="setT(11)"><div class="t-prev" style="background:#1e1e2e;"></div> Midnight</div>
  <div class="theme-opt" onclick="setT(12)"><div class="t-prev" style="background:#300;"></div> Red Glow</div>
  <div class="theme-opt" onclick="setT(13)"><div class="t-prev" style="background:#002b36;"></div> Solar Dark</div>
  <div class="theme-opt" onclick="setT(14)"><div class="t-prev" style="background:#333;"></div> Blueprint</div>
  <div class="theme-opt" onclick="setT(15)"><div class="t-prev" style="background:#000; border-bottom: 3px solid #f0f;"></div> Synth Line</div>
  <div class="theme-opt" onclick="setT(16)"><div class="t-prev" style="background:radial-gradient(#333,#000);"></div> Vignette</div>
  <div class="theme-opt" onclick="setT(17)"><div class="t-prev" style="background:#111;"></div> Micro Dot</div>
  <div class="theme-opt" onclick="setT(18)"><div class="t-prev" style="border: 1px solid #0ff;"></div> Inset Frame</div>
  <div class="theme-opt" onclick="setT(19)"><div class="t-prev" style="background:#050; color:#0f0"></div> Aggressive</div>
  <div class="theme-opt" onclick="setT(20)"><div class="t-prev" style="border-right: 3px solid #f00;"></div> Final Border</div>
  <div class="theme-opt" onclick="setT(21)"><div class="t-prev" style="background:#0a0a0c;"></div> Original Black</div>
</div>

<div id="yt-player"></div>

<h1>ARCADE</h1>
<p class="sub">FRAME STUDIO</p>

<div id="studio-view" style="display: flex; flex-direction: column; align-items: center; width: 100%;">
  <div id="box"><canvas id="c" width="800" height="800"></canvas><div id="shine-flare"></div></div>
  <div class="ui">
    <label class="btn" onclick="playClick()">STEP 1: CHOOSE PHOTO<input type="file" id="u1" accept="image/*"></label>
    <label class="btn btn-r" onclick="playClick()">STEP 2: UPLOAD FRAME<input type="file" id="u2" accept="image/*"></label>
    <button class="btn btn-center" onclick="centerSubject()">CENTER SUBJECT üéØ</button>
    <button class="btn btn-shine" onclick="runShine()">PREVIEW FRAME SHINE ‚ú®</button>
    <div class="lbl">ZOOM PHOTO <span id="z-val" class="val-tag">100%</span></div>
    <input type="range" id="z" min="0.1" max="4" step="0.01" value="1">
    <div class="lbl">CIRCLE SIZE <span id="m-val" class="val-tag">375px</span></div>
    <input type="range" id="m" min="300" max="400" step="1" value="375">
    <button id="save">DOWNLOAD PICTURE</button>
  </div>
</div>

<div id="about-page">
  <div class="about-wrap">
    <button class="back-btn" onclick="toggleAboutPage()">‚Üê BACK TO STUDIO</button>
    <div class="sec-h" style="margin-top:0;">ABOUT ARCADE STUDIO</div>
    <p style="color:#aaa; font-size:14px;">Arcade Studio is the elite high-performance platform for digital creators. Features animated titles, a 21-theme visual selection bay, and precision alignment tools.</p>
    <div class="sec-h">ELITE CAPABILITIES</div>
    <p style="color:#aaa; font-size:14px;"><b>Animated Titles:</b> High-energy arcade headers with elastic bounce logic. <br><br><b>Visual Theme Selection:</b> Select from 20 unique aesthetics with live previews.</p>
    <div class="sec-h">OPERATIONAL GUIDELINES</div>
    <p style="color:#888; font-size:14px;">
      <span class="red-step">1. Upload:</span> Choose photo and frame using Steps 1 & 2. <br><br>
      <span class="red-step">2. Visual Style:</span> Open theme menu and pick an aesthetic. <br><br>
      <span class="red-step">3. Symmetry:</span> Use Center Subject for perfect alignment. <br><br>
      <span class="red-step">4. Lock Frame:</span> Align Circle Size and Zoom until gaps are hidden. <br><br>
      <span class="red-step">5. Export:</span> Click Download to save your high-res PNG.
    </p>
  </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
const c=document.getElementById('c'),x=c.getContext('2d'),z=document.getElementById('z'),m=document.getElementById('m'),sBtn=document.getElementById('save'),panel=document.getElementById('menu-panel'),tMenu=document.getElementById('theme-selector'),aboutPage=document.getElementById('about-page'),studioView=document.getElementById('studio-view'),box=document.getElementById('box');
const zVal=document.getElementById('z-val'),mVal=document.getElementById('m-val'),mStat=document.getElementById('m-status');
let i=new Image(),f=new Image(),cfg={s:1,m:375,x:400,y:400,r:0,d:false,lx:0,ly:0,ia:0,ir:0},originalFileName="Arcade_PFP",player,musicOn=true,audioStarted=false,curT=8;

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function onYouTubeIframeAPIReady() { player = new YT.Player('yt-player', { height: '0', width: '0', videoId: 'nv_2rz5BFDA', playerVars: { 'autoplay': 1, 'loop': 1, 'playlist': 'nv_2rz5BFDA' }, events: { 'onReady': e => { e.target.setVolume(25); if(musicOn) e.target.playVideo(); } } }); }
function startAudio() { if (!audioStarted) { audioCtx.resume(); if(player && musicOn) player.playVideo(); audioStarted = true; } }
function toggleAboutPage() { playShutter(); const isOpen = aboutPage.style.display === 'block'; aboutPage.style.display = isOpen ? 'none' : 'block'; studioView.style.display = isOpen ? 'flex' : 'none'; if(!isOpen) { panel.classList.remove('open'); window.scrollTo(0,0); } }

function openThemeSelector() { panel.classList.remove('open'); tMenu.classList.add('open'); playClick(); }
function closeThemeSelector() { tMenu.classList.remove('open'); panel.classList.add('open'); playClick(); }
function setT(n) { startAudio(); playClick(); document.body.classList.remove('t'+curT); curT=n; document.body.classList.add('t'+curT); tMenu.classList.remove('open'); }

function centerSubject() { if(!i.src) return; playShutter(); cfg.x = 400; cfg.y = 400; d(); }
function runShine() { if(!f.src) return; playShutter(); box.classList.add('shine-active'); setTimeout(()=>box.classList.remove('shine-active'), 1500); }
function toggleMusic() { startAudio(); playClick(); musicOn = !musicOn; if(musicOn) { player.playVideo(); mStat.innerText = "ON"; mStat.style.color = "#ff0000"; } else { player.pauseVideo(); mStat.innerText = "OFF"; mStat.style.color = "#888"; } }
function toggleMenu(e) { e.stopPropagation(); startAudio(); playClick(); panel.classList.toggle('open'); tMenu.classList.remove('open'); }
window.onclick = e => { if (panel.classList.contains('open') && !panel.contains(e.target)) { panel.classList.remove('open'); playClick(); } };

function playWin() { const notes = [523.25, 659.25, 783.99, 1046.50]; notes.forEach((freq, idx) => { const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.frequency.setValueAtTime(freq, audioCtx.currentTime + (idx * 0.1)); gain.gain.setValueAtTime(0.1, audioCtx.currentTime + (idx * 0.1)); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + (idx * 0.1) + 0.1); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(audioCtx.currentTime + (idx * 0.1)); osc.stop(audioCtx.currentTime + (idx * 0.1) + 0.1); }); }
function playClick() { const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.frequency.setValueAtTime(800, audioCtx.currentTime); gain.gain.setValueAtTime(0.1, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.1); }
function playShutter() { const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type = 'square'; osc.frequency.setValueAtTime(200, audioCtx.currentTime); osc.frequency.setValueAtTime(400, audioCtx.currentTime + 0.05); gain.gain.setValueAtTime(0.1, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.15); }
function playSlider(val) { const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.frequency.setValueAtTime(200 + (val > 5 ? (val-300)*5 : val * 100), audioCtx.currentTime); gain.gain.setValueAtTime(0.02, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.05); }
function updateSliderColor(el) { const percent = ((el.value - el.min) / (el.max - el.min)) * 100; el.style.setProperty('--v', percent + '%'); }
function d(){ x.clearRect(0,0,800,800); x.save(); x.beginPath(); x.arc(400,400,cfg.m,0,6.28); x.clip(); if(i.src){ let w=i.width*cfg.s, h=i.height*cfg.s; x.save(); x.translate(cfg.x, cfg.y); x.rotate(cfg.r); x.drawImage(i, -w/2, -h/2,w,h); x.restore(); } x.restore(); if(f.src) { x.drawImage(f, 0, 0, 800, 800); } if (i.src || f.src) sBtn.classList.add('active'); }
function handleFile(file) { originalFileName = file.name.split('.').slice(0, -1).join('.') || "Arcade_PFP"; let r=new FileReader(); r.onload=v=>{ const nextI = new Image(); nextI.onload=()=>{ i=nextI; cfg.s=Math.max(800/i.width,800/i.height); z.value=cfg.s; zVal.innerText=Math.round(cfg.s*100)+"%"; updateSliderColor(z); d(); playClick(); }; nextI.src=v.target.result; }; r.readAsDataURL(file); }
document.querySelectorAll('input[type=range]').forEach(el => { el.addEventListener('input', () => { updateSliderColor(el); playSlider(el.value); }); updateSliderColor(el); });
document.getElementById('u1').onchange=e=>handleFile(e.target.files[0]);
document.getElementById('u2').onchange=e=>{ const file = e.target.files[0]; if(!file) return; let r=new FileReader(); r.onload=v=>{ f.src=v.target.result; f.onload=d; }; r.readAsDataURL(file); };
z.oninput=e=>{ cfg.s=parseFloat(e.target.value); zVal.innerText=Math.round(cfg.s*100)+"%"; d(); };
m.oninput=e=>{ cfg.m=parseInt(e.target.value); mVal.innerText=e.target.value+"px"; d(); };
function gp(e, idx=0){ let r=c.getBoundingClientRect(), t=e.touches?e.touches[idx]:e; return {x:(t.clientX-r.left)*(800/r.width),y:(t.clientY-r.top)*(800/r.height)}; }
function st(e){ if(e.target==c){ e.preventDefault(); cfg.d=true; if(e.touches && e.touches.length === 2) { cfg.ia = Math.atan2(e.touches[1].pageY - e.touches[0].pageY, e.touches[1].pageX - e.touches[0].pageX); cfg.ir = cfg.r; } else { let p=gp(e); cfg.lx=p.x-cfg.x; cfg.ly=p.y-cfg.y; } } }
function mv(e){ if(cfg.d){ e.preventDefault(); if(e.touches && e.touches.length === 2) { let a = Math.atan2(e.touches[1].pageY - e.touches[0].pageY, e.touches[1].pageX - e.touches[0].pageX); cfg.r = cfg.ir + (a - cfg.ia); } else { let p=gp(e); cfg.x=p.x-cfg.lx; cfg.y=p.y-cfg.ly; } d(); } }
function en(){ cfg.d=false; }
c.ontouchstart=st; window.ontouchmove=mv; window.ontouchend=en; c.onmousedown=st; window.onmousemove=mv; window.onmouseup=en;
sBtn.onclick=()=>{ if(!i.src && !f.src) return; playWin(); let a=document.createElement('a'); a.download = originalFileName + '.png'; a.href=c.toDataURL(); a.click(); };
</script>
</body>
</html>
