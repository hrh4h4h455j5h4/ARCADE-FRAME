<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Arcade Studio</title>
<style>
  html { scroll-behavior: smooth; }
  body {
    background: #0a0a0c; color: white; font-family: sans-serif; /* REVERTED TO ORIGINAL FONT */
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh; margin: 0; padding-bottom: 120px;
    -webkit-overflow-scrolling: touch; transition: 0.3s;
  }
  
  .top-btns { position: absolute; top: 15px; left: 15px; width: calc(100% - 30px); display: flex; justify-content: space-between; z-index: 1000; }
  .btn-ui { background: #1a1a1c; color: #ffffff; border: 1px solid rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 11px; }

  #menu-panel { position: fixed; top: 0; left: -250px; width: 230px; height: 100%; background: #000; padding-top: 60px; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 999; display: flex; flex-direction: column; gap: 10px; padding-left: 15px; padding-right: 15px; }
  #menu-panel.open { left: 0; }
  .lnk, .music-btn { display: flex; align-items: center; gap: 10px; padding: 12px; text-decoration: none; color: white; font-size: 13px; font-weight: bold; border-radius: 4px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); cursor: pointer; }
  .music-btn { border-color: #ff0000; background: rgba(255,0,0,0.1); justify-content: space-between; }
  .lnk svg { width: 18px; height: 18px; fill: white; }

  /* ABOUT PAGE STYLES */
  #about-page { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000000; z-index: 2000; overflow-y: auto; padding: 80px 20px 40px 20px; box-sizing: border-box; text-align: left; }
  .about-wrap { max-width: 700px; margin: auto; line-height: 1.6; }
  .back-btn { background: #ff0000; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-weight: bold; cursor: pointer; margin-bottom: 30px; }
  .sec-h { color: #00ffff; font-size: 14px; letter-spacing: 2px; border-bottom: 1px solid #222; margin-top: 30px; padding-bottom: 8px; font-weight: bold; text-transform: uppercase; }

  h1 { color: #ffffff; margin: 30px 0 0 0; font-family: "Arial Black", sans-serif; font-style: italic; font-size: 36px; text-transform: uppercase; letter-spacing: -1px; text-shadow: 2px 2px 0px #ff0000, -1px -1px 10px rgba(255, 0, 0, 0.8); }
  p.sub { color: #ffffff; font-weight: bold; margin: 2px 0 15px 0; text-transform: uppercase; font-size: 11px; letter-spacing: 2px; }

  #box { position: relative; width: 310px; height: 310px; border-radius: 50%; overflow: hidden; background-image: linear-gradient(45deg,#111 25%,transparent 25%),linear-gradient(-45deg,#111 25%,transparent 25%),linear-gradient(45deg,transparent 75%,#111 75%),linear-gradient(-45deg,transparent 75%,#111 75%); background-size: 20px 20px; box-shadow: 0 0 20px rgba(0,0,0,0.5); border: 2px solid transparent; transition: 0.3s; -webkit-mask-image: -webkit-radial-gradient(white,black); }
  canvas { position: absolute; top: 0; left: 0; width: 310px; height: 310px; touch-action: none; }
  
  .ui { margin-top: 10px; width: 260px; display: flex; flex-direction: column; gap: 6px; }
  .btn { background: #111; border: 2px solid #ffffff; color: white; padding: 10px; text-align: center; border-radius: 8px; font-weight: bold; display: block; font-size: 11px; cursor: pointer; }
  .btn-r { border-color: #ff0000; }
  .btn-reset { border-color: #555; color: #888; }
  .lbl { font-size: 9px; color: #888; text-transform: uppercase; margin-top: 2px; display: flex; justify-content: space-between; }
  .val-tag { color: #00ffff; font-weight: bold; font-family: monospace; }

  input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; margin: 10px 0; }
  input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 8px; cursor: pointer; background: linear-gradient(to right, #ff0000 var(--v, 0%), #00ffff var(--v, 0%)); border-radius: 4px; }
  input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #ff0000; cursor: pointer; margin-top: -6px; box-shadow: 0 0 10px #ff0000; border: 2px solid #ffffff; }
  
  #save { background: #ff0000; border: none; font-size: 13px; color: white; padding: 12px; border-radius: 8px; font-weight: bold; margin-top: 4px; cursor: not-allowed; opacity: 0.4; transition: 0.2s; }
  #save.active { cursor: pointer; opacity: 1; }

  body.pc-mode { padding: 0; overflow: hidden; display: block; }
  body.pc-mode h1, body.pc-mode p.sub { display: none; }
  body.pc-mode .main-wrapper { flex-direction: row-reverse; height: 100vh; align-items: stretch; display: flex; width: 100%; }
  body.pc-mode .ui { background: #000; width: 350px; height: 100vh; margin: 0; padding: 80px 25px 30px 25px; box-sizing: border-box; overflow-y: auto; border-right: 1px solid rgba(255,255,255,0.1); }
  body.pc-mode .ui::before { content: "ARCADE STUDIO"; display: block; font-family: "Arial Black", sans-serif; font-size: 24px; color: #ff0000; margin-bottom: 30px; letter-spacing: -1px; font-style: italic; }
  body.pc-mode #box { margin: auto; width: 450px; height: 450px; }
  body.pc-mode canvas { width: 450px; height: 450px; }
  .pc-only { display: none; }
  body.pc-mode .pc-only { display: block; }
  input[type=file] { display: none; }
  #yt-player { display: none; }
</style>
</head>
<body onclick="startAudio()">

<div class="top-btns">
  <button class="btn-ui" onclick="toggleMenu(event)">MENU ☰</button>
  <button id="mode-toggle" class="btn-ui" onclick="toggleMode()">PC VERSION</button>
</div>

<div id="menu-panel">
  <div class="music-btn" onclick="toggleMusic()">MUSIC CONTROL <span id="m-status" style="color:#ff0000;">ON</span></div>
  <a href="https://discord.gg/ardc" target="_blank" class="lnk" style="border-color:#5865F2;" onclick="playShutter()">Discord Server</a>
  <a href="https://platopedia.com/groups/arcade" target="_blank" class="lnk" style="border-color:#00ffff;" onclick="playShutter()">Arcade Website</a>
  <div class="lnk" style="border-color:#ffffff;" onclick="toggleAboutPage()">ABOUT US ℹ️</div>
</div>

<div id="about-page">
  <div class="about-wrap">
    <button class="back-btn" onclick="toggleAboutPage()">← BACK TO STUDIO</button>

    <div class="sec-h" style="margin-top:0;">ABOUT ARCADE STUDIO</div>
    <p style="color:#aaa; font-size:14px;">Arcade Studio is the ultimate high-performance platform for Plato app players and digital creators. Designed to deliver pixel-perfect results with an aggressive retro-inspired interface, our engine adapts to your device to provide a professional editing workbench on PC and a high-speed app experience on Mobile.</p>

    <div class="sec-h">CORE CAPABILITIES</div>
    <p style="color:#aaa; font-size:14px;">
      <b>Circle Size:</b> The "Frame Lock" tool. Adjust the clipping window to expand or shrink the viewing hole of your subject. Essential for eliminating "checkerboard gaps" and ensuring your subject fits custom frame borders perfectly.<br><br>
      <b>Subject Scaling (Zoom):</b> Professional high-resolution subject scaling with unique percentage tracking.<br><br>
      <b>Pro Touch Controls:</b> High-precision one-finger dragging and advanced multi-touch rotation for 360-degree subject alignment.
    </p>

    <div class="sec-h">OPERATIONAL GUIDELINES</div>
    <p style="color:#888; font-size:14px;">
      1. <b>Choose Photo:</b> Upload your base subject photo using Step 1. <br><br>
      2. <b>Apply Frame:</b> Overlay your Arcade Frame using Step 2. <br><br>
      3. <b>Adjust Circle Size:</b> Shrink or grow the hole until the background gaps disappear. This ensures a clean "Official" look.<br><br>
      4. <b>Refine Zoom:</b> Scale the subject to match your frame composition. <br><br>
      5. <b>Align:</b> Use one finger to drag the subject into position, or two fingers to spin it into a custom angle. <br><br>
      6. <b>Export:</b> Click Download to save your high-resolution PNG instantly.
    </p>
  </div>
</div>

<div id="yt-player"></div>

<div id="studio-view" style="display: flex; flex-direction: column; align-items: center; width: 100%;">
  <h1>ARCADE</h1>
  <p class="sub">FRAME STUDIO</p>
  <div class="main-wrapper">
    <div id="box"><canvas id="c" width="800" height="800"></canvas></div>
    <div class="ui">
      <label class="btn" onclick="playClick()">STEP 1: CHOOSE PHOTO<input type="file" id="u1" accept="image/*"></label>
      <label class="btn btn-r" onclick="playClick()">STEP 2: UPLOAD FRAME<input type="file" id="u2" accept="image/*"></label>
      <div class="pc-only">
        <div class="lbl">FRAME TINT & SHINE <span id="ft-val" class="val-tag">0°</span></div>
        <input type="range" id="ft" min="0" max="360" step="1" value="0">
      </div>
      <button class="btn btn-reset" onclick="resetProject()">RESET PROJECT</button>
      <div class="lbl">ZOOM PHOTO <span id="z-val" class="val-tag">100%</span></div>
      <input type="range" id="z" min="0.1" max="4" step="0.01" value="1">
      <div class="lbl">CIRCLE SIZE <span id="m-val" class="val-tag">375px</span></div>
      <input type="range" id="m" min="300" max="400" step="1" value="375">
      <button id="save">DOWNLOAD PICTURE</button>
    </div>
  </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
const c=document.getElementById('c'),x=c.getContext('2d'),z=document.getElementById('z'),m=document.getElementById('m'),ft=document.getElementById('ft'),sBtn=document.getElementById('save'),panel=document.getElementById('menu-panel'),aboutPage=document.getElementById('about-page'),studioView=document.getElementById('studio-view'),modeBtn=document.getElementById('mode-toggle'),mStat=document.getElementById('m-status');
const zVal=document.getElementById('z-val'),mVal=document.getElementById('m-val'),ftVal=document.getElementById('ft-val');
let i=new Image(),f=new Image(),cfg={s:1,m:375,x:400,y:400,r:0,ft:0,d:false,lx:0,ly:0,ia:0,ir:0},originalFileName="Arcade_PFP",player,musicOn=true,audioStarted=false;

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function onYouTubeIframeAPIReady() {
  player = new YT.Player('yt-player', { height: '0', width: '0', videoId: 'nv_2rz5BFDA', playerVars: { 'autoplay': 1, 'loop': 1, 'playlist': 'nv_2rz5BFDA' },
    events: { 'onReady': e => { e.target.setVolume(25); if(musicOn) e.target.playVideo(); } }
  });
}

function startAudio() { if (!audioStarted) { audioCtx.resume(); if(player && musicOn) player.playVideo(); audioStarted = true; } }
function toggleMode() { startAudio(); playClick(); const isPC = document.body.classList.toggle('pc-mode'); modeBtn.innerText = isPC ? "MOBILE VERSION" : "PC VERSION"; d(); }

function toggleAboutPage() {
  playShutter(); const isOpen = aboutPage.style.display === 'block';
  aboutPage.style.display = isOpen ? 'none' : 'block'; studioView.style.display = isOpen ? 'flex' : 'none';
  if(!isOpen) { panel.classList.remove('open'); window.scrollTo(0,0); }
}

function resetProject() {
  playDown(); i = new Image(); f = new Image(); cfg={s:1,m:375,x:400,y:400,r:0,ft:0,d:false,lx:0,ly:0}; z.value = 1; m.value = 375; if(ft) ft.value = 0;
  zVal.innerText="100%"; mVal.innerText="375px"; if(ftVal) ftVal.innerText="0°";
  document.querySelectorAll('input[type=range]').forEach(updateSliderColor); sBtn.classList.remove('active'); d();
}

function toggleMusic() { startAudio(); playClick(); musicOn = !musicOn; if(musicOn) { player.playVideo(); mStat.innerText = "ON"; mStat.style.color = "#ff0000"; } else { player.pauseVideo(); mStat.innerText = "OFF"; mStat.style.color = "#888"; } }
function toggleMenu(e) { e.stopPropagation(); startAudio(); playClick(); panel.classList.toggle('open'); }
window.onclick = e => { if (panel.classList.contains('open') && !panel.contains(e.target)) { panel.classList.remove('open'); playClick(); } };

function playClick() { const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.frequency.setValueAtTime(800, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1); gain.gain.setValueAtTime(0.1, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.1); }
function playDown() { const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.frequency.setValueAtTime(400, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.3); gain.gain.setValueAtTime(0.1, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.3); }
function playShutter() { const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type = 'square'; osc.frequency.setValueAtTime(200, audioCtx.currentTime); osc.frequency.setValueAtTime(400, audioCtx.currentTime + 0.05); gain.gain.setValueAtTime(0.1, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.15); }
function playSlider(val) { const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.frequency.setValueAtTime(200 + (val > 5 ? (val-300)*5 : val * 100), audioCtx.currentTime); gain.gain.setValueAtTime(0.02, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.05); }

function updateSliderColor(el) { const percent = ((el.value - el.min) / (el.max - el.min)) * 100; el.style.setProperty('--v', percent + '%'); }

function d(){
  x.clearRect(0,0,800,800); x.save(); x.beginPath(); x.arc(400,400,cfg.m,0,6.28); x.clip();
  if(i.src){ 
    let w=i.width*cfg.s, h=i.height*cfg.s; 
    x.save(); x.translate(cfg.x, cfg.y); x.rotate(cfg.r); x.drawImage(i, -w/2, -h/2, w, h); x.restore();
  }
  x.restore(); 
  if(f.src) {
    if(document.body.classList.contains('pc-mode')) {
        let ht = cfg.ft;
        if(ht >= 40 && ht <= 55) { x.filter = `sepia(1) saturate(12) hue-rotate(-10deg) brightness(1.1) contrast(1.2)`; }
        else if(ht > 350 || ht < 10) { x.filter = `grayscale(1) brightness(1.5) contrast(1.5)`; }
        else { x.filter = `sepia(1) saturate(8) hue-rotate(${ht}deg) brightness(1) contrast(1.1)`; }
    }
    x.drawImage(f, 0, 0, 800, 800); x.filter = "none";
  }
  if (i.src || f.src) sBtn.classList.add('active');
}

document.getElementById('box').ondragover = e => e.preventDefault();
document.getElementById('box').ondrop = e => { e.preventDefault(); const file = e.dataTransfer.files[0]; if (file && file.type.startsWith('image/')) handleFile(file); };

function handleFile(file) {
  originalFileName = file.name.split('.').slice(0, -1).join('.') || "Arcade_PFP";
  let r=new FileReader(); r.onload=v=>{ i.src=v.target.result; i.onload=()=>{ cfg.s=Math.max(800/i.width,800/i.height); z.value=cfg.s; zVal.innerText=Math.round(cfg.s*100)+"%"; updateSliderColor(z); d(); playClick(); } }; r.readAsDataURL(file);
}

document.querySelectorAll('input[type=range]').forEach(el => { el.addEventListener('input', () => { updateSliderColor(el); playSlider(el.value); }); updateSliderColor(el); });
document.getElementById('u1').onchange=e=>handleFile(e.target.files[0]);
document.getElementById('u2').onchange=e=>{ const file = e.target.files[0]; if(!file) return; let r=new FileReader(); r.onload=v=>{ f.src=v.target.result; f.onload=d; }; r.readAsDataURL(file); };
z.oninput=e=>{ cfg.s=parseFloat(e.target.value); zVal.innerText=Math.round(cfg.s*100)+"%"; d(); };
m.oninput=e=>{ cfg.m=parseInt(e.target.value); mVal.innerText=e.target.value+"px"; d(); };
if(ft) ft.oninput=e=>{ cfg.ft=parseInt(e.target.value); ftVal.innerText=e.target.value+"°"; d(); };

function gp(e, idx=0){ let r=c.getBoundingClientRect(), t=e.touches?e.touches[idx]:e; return {x:(t.clientX-r.left)*(800/r.width),y:(t.clientY-r.top)*(800/r.height)}; }
function st(e){ if(e.target==c){ e.preventDefault(); cfg.d=true; if(e.touches && e.touches.length === 2) { cfg.ia = Math.atan2(e.touches[1].pageY - e.touches[0].pageY, e.touches[1].pageX - e.touches[0].pageX); cfg.ir = cfg.r; } else { let p=gp(e); cfg.lx=p.x-cfg.x; cfg.ly=p.y-cfg.y; } } }
function mv(e){ if(cfg.d){ e.preventDefault(); if(e.touches && e.touches.length === 2) { let a = Math.atan2(e.touches[1].pageY - e.touches[0].pageY, e.touches[1].pageX - e.touches[0].pageX); cfg.r = cfg.ir + (a - cfg.ia); } else { let p=gp(e); cfg.x=p.x-cfg.lx; cfg.y=p.y-cfg.ly; } d(); } }
function en(){ cfg.d=false; }
c.ontouchstart=st; window.ontouchmove=mv; window.ontouchend=en; c.onmousedown=st; window.onmousemove=mv; window.onmouseup=en;
sBtn.onclick=()=>{ if(!i.src && !f.src) return; playClick(); let a=document.createElement('a'); a.download = originalFileName + '.png'; a.href=c.toDataURL(); a.click(); };
</script>
</body>
</html>
