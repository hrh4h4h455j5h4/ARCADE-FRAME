<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Arcade Studio Suite</title>
<style>
  html { scroll-behavior: smooth; }
  body {
    background: #0a0a0c; color: white; font-family: sans-serif;
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh; margin: 0; padding-bottom: 120px;
    background-image: linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px);
    background-size: 100% 4px;
  }

  /* TOP RIGHT SWITCH BUTTON */
  .mode-switch {
    position: fixed; top: 15px; right: 15px;
    background: #ff0000; color: white; border: 2px solid white;
    padding: 10px 15px; border-radius: 8px; font-weight: bold;
    cursor: pointer; z-index: 1001; font-size: 12px;
    box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
  }

  h1 {
    color: #ffffff; margin: 30px 0 0 0; font-family: "Arial Black", sans-serif; font-style: italic;
    font-size: 36px; text-transform: uppercase; letter-spacing: -1px;
    text-shadow: 2px 2px 0px #ff0000;
  }
  .sub { color: #ffffff; font-weight: bold; margin: 2px 0 15px 0; text-transform: uppercase; font-size: 11px; letter-spacing: 2px; }

  #box {
    position: relative; width: 310px; height: 310px; border-radius: 50%; overflow: hidden;
    background: #111; border: 2px solid #ff0000; z-index: 10;
  }
  canvas { position: absolute; top: 0; left: 0; width: 310px; height: 310px; touch-action: none; z-index: 15; }
  
  .ui { margin-top: 20px; width: 300px; display: flex; flex-direction: column; gap: 8px; }
  .btn {
    background: #111; border: 2px solid #ffffff; color: white; padding: 10px; text-align: center;
    border-radius: 8px; font-weight: bold; font-size: 12px; cursor: pointer;
  }
  .btn-r { border-color: #ff0000; }
  
  /* HIDDEN ELEMENTS */
  #video-element { display: none; }
  .hidden { display: none; }

  .lbl { font-size: 9px; color: #888; text-transform: uppercase; margin-top: 2px; display: flex; justify-content: space-between; }
  .val-tag { color: #ff0000; font-weight: bold; }

  input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; margin: 10px 0; }
  input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 8px; background: #333; border-radius: 4px; }
  input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #ff0000; margin-top: -6px; border: 2px solid white; }

  #save-btn {
    background: #ff0000; border: none; font-size: 14px; color: white; padding: 12px;
    border-radius: 8px; font-weight: bold; cursor: pointer;
  }
</style>
</head>
<body>

<button class="mode-switch" id="toggleMode" onclick="switchMode()">SWITCH TO GIF STUDIO</button>

<h1 id="main-title">ARCADE</h1>
<p class="sub" id="sub-title">FRAME STUDIO</p>

<div id="box">
    <canvas id="c" width="800" height="800"></canvas>
</div>

<video id="video-element" autoplay loop muted playsinline></video>

<div class="ui">
  <label class="btn" id="upload-label">STEP 1: CHOOSE PHOTO
    <input type="file" id="file-input" accept="image/*" style="display:none;" onchange="handleFile(event)">
  </label>

  <label class="btn btn-r">STEP 2: UPLOAD FRAME
    <input type="file" id="frame-input" accept="image/*" style="display:none;" onchange="handleFrame(event)">
  </label>
  
  <div class="lbl">ZOOM <span id="z-val" class="val-tag">100%</span></div>
  <input type="range" id="z" min="0.1" max="4" step="0.01" value="1" oninput="updateZ(this.value)">
  
  <button id="save-btn" onclick="saveOutput()">DOWNLOAD PICTURE</button>
</div>

<script>
const c = document.getElementById('c'), x = c.getContext('2d');
const video = document.getElementById('video-element');
const fileInput = document.getElementById('file-input');
const uploadLabel = document.getElementById('upload-label');
const modeBtn = document.getElementById('toggleMode');
const mainTitle = document.getElementById('main-title');
const subTitle = document.getElementById('sub-title');
const saveBtn = document.getElementById('save-btn');

let currentMode = 'image'; // 'image' or 'gif'
let img = new Image(), frame = new Image();
let cfg = { s: 1, x: 400, y: 400, d: false, lx: 0, ly: 0 };

function switchMode() {
    if (currentMode === 'image') {
        currentMode = 'gif';
        modeBtn.innerText = "SWITCH TO FRAME STUDIO";
        mainTitle.innerText = "GIF STUDIO";
        subTitle.innerText = "VIDEO CONVERTER";
        uploadLabel.innerHTML = 'STEP 1: UPLOAD VIDEO <input type="file" id="file-input" accept="video/*" style="display:none;" onchange="handleFile(event)">';
        saveBtn.innerText = "CONVERT TO GIF";
    } else {
        currentMode = 'image';
        modeBtn.innerText = "SWITCH TO GIF STUDIO";
        mainTitle.innerText = "ARCADE";
        subTitle.innerText = "FRAME STUDIO";
        uploadLabel.innerHTML = 'STEP 1: CHOOSE PHOTO <input type="file" id="file-input" accept="image/*" style="display:none;" onchange="handleFile(event)">';
        saveBtn.innerText = "DOWNLOAD PICTURE";
    }
    resetCanvas();
}

function handleFile(e) {
    const file = e.target.files[0];
    if (!file) return;

    if (currentMode === 'gif') {
        const url = URL.createObjectURL(file);
        video.src = url;
        video.play();
        renderVideo();
    } else {
        const reader = new FileReader();
        reader.onload = v => {
            img = new Image();
            img.onload = () => { draw(); };
            img.src = v.target.result;
        };
        reader.readAsDataURL(file);
    }
}

function handleFrame(e) {
    const reader = new FileReader();
    reader.onload = v => {
        frame = new Image();
        frame.onload = () => { draw(); };
        frame.src = v.target.result;
    };
    reader.readAsDataURL(e.target.files[0]);
}

function renderVideo() {
    if (currentMode !== 'gif') return;
    draw();
    requestAnimationFrame(renderVideo);
}

function draw() {
    x.clearRect(0, 0, 800, 800);
    x.save();
    
    // Circle Mask
    x.beginPath();
    x.arc(400, 400, 375, 0, Math.PI * 2);
    x.clip();

    if (currentMode === 'gif' && video.readyState >= 2) {
        let w = video.videoWidth * cfg.s, h = video.videoHeight * cfg.s;
        x.drawImage(video, cfg.x - w/2, cfg.y - h/2, w, h);
    } else if (img.src) {
        let w = img.width * cfg.s, h = img.height * cfg.s;
        x.drawImage(img, cfg.x - w/2, cfg.y - h/2, w, h);
    }
    
    x.restore();
    if (frame.src) x.drawImage(frame, 0, 0, 800, 800);
}

function updateZ(v) { 
    cfg.s = parseFloat(v); 
    document.getElementById('z-val').innerText = Math.round(v * 100) + "%";
    draw(); 
}

function resetCanvas() {
    img = new Image();
    video.src = "";
    draw();
}

function saveOutput() {
    if (currentMode === 'gif') {
        alert("GIF Processing: In a live environment, this would now compile frames into a .gif file.");
    } else {
        let a = document.createElement('a');
        a.download = 'Arcade_PFP.png';
        a.href = c.toDataURL();
        a.click();
    }
}

// Drag logic
function st(e) { cfg.d = true; let p = gp(e); cfg.lx = p.x - cfg.x; cfg.ly = p.y - cfg.y; }
function mv(e) { if (cfg.d) { let p = gp(e); cfg.x = p.x - cfg.lx; cfg.y = p.y - cfg.ly; draw(); } }
function en() { cfg.d = false; }
function gp(e) { 
    let r = c.getBoundingClientRect(), t = e.touches ? e.touches[0] : e;
    return { x: (t.clientX - r.left) * (800 / r.width), y: (t.clientY - r.top) * (800 / r.height) };
}
c.onmousedown = st; window.onmousemove = mv; window.onmouseup = en;
c.ontouchstart = st; window.ontouchmove = mv; window.ontouchend = en;

</script>
</body>
</html>
