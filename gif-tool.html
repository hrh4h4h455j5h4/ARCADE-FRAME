<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NeonFocus | Pro HD</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>

    <style>
        :root { --neon: #00f3ff; --purple: #bc13fe; --red: #ff0055; --bg: #000000; }

        /* HIDE SCROLLBARS */
        ::-webkit-scrollbar { display: none; }
        * { -ms-overflow-style: none; scrollbar-width: none; }

        body { 
            background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; 
            display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
            min-height: 100vh; margin: 0; overflow-y: auto; overflow-x: hidden; 
            width: 100%; padding-top: 40px; padding-bottom: 60px;
        }
        
        /* --- STAGE & NEON --- */
        .stage { 
            position: relative; width: 320px; height: 320px; flex-shrink: 0; 
            display: flex; align-items: center; justify-content: center; margin-bottom: 30px; 
            touch-action: none; 
        }

        .led-ring { 
            position: absolute; inset: -15px; border-radius: 50%; 
            background: conic-gradient(from 0deg, transparent, var(--neon), var(--purple), transparent); 
            animation: rotate 2s linear infinite; filter: blur(20px); opacity: 1; z-index: 1; pointer-events: none;
        }

        .viewport { 
            position: relative; z-index: 5; width: 100%; height: 100%; border-radius: 50%; 
            overflow: hidden; cursor: move; background-color: #000;
            background-image: linear-gradient(45deg, #1a1a1a 25%, transparent 25%), linear-gradient(-45deg, #1a1a1a 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #1a1a1a 75%), linear-gradient(-45deg, transparent 75%, #1a1a1a 75%);
            background-size: 20px 20px; box-shadow: inset 0 0 20px #000; transform: translateZ(0); touch-action: none;
        }

        #v { position: absolute; top: 0; left: 0; min-width: 100%; min-height: 100%; width: auto; height: auto; transform-origin: top left; pointer-events: none; will-change: left, top, width, height; }
        #o { width: 100%; height: 100%; object-fit: cover; display: none; }

        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* --- UI PANEL --- */
        .ui { 
            z-index: 10; background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(20px); 
            padding: 25px; border-radius: 30px; width: 340px; border: 1px solid rgba(255,255,255,0.1); 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); margin-bottom: 20px; max-width: 90%; box-sizing: border-box;
            display: flex; flex-direction: column; align-items: center;
        }
        
        .btn-upload { background: linear-gradient(90deg, var(--neon), var(--purple)); color: #000; border: none; padding: 15px; border-radius: 50px; font-weight: 800; cursor: pointer; width: 100%; margin-bottom: 25px; font-size: 14px; letter-spacing: 0.5px; box-shadow: 0 0 25px rgba(0, 243, 255, 0.2); }
        .btn-upload:disabled { opacity: 0.3; cursor: not-allowed; filter: grayscale(1); }

        .label-row { display: flex; justify-content: space-between; font-size: 11px; color: #888; margin-bottom: 8px; font-weight: 600; width: 100%; }
        input[type="range"] { width: 100%; accent-color: var(--neon); margin-bottom: 25px; cursor: pointer; }
        input[type="range"]:disabled { opacity: 0.2; cursor: not-allowed; }

        .btn-go { background: transparent; color: white; border: 1px solid var(--neon); padding: 15px; width: 100%; border-radius: 15px; cursor: pointer; font-weight: bold; font-size: 14px; transition: 0.2s; }
        
        /* GRAY-LOCK STYLE FOR BUTTON */
        .btn-go:disabled { opacity: 0.4; cursor: not-allowed; background: #1a1a1a; border-color: #333; color: #666; }

        .status { margin-top: 20px; font-size: 14px; text-align: center; color: var(--neon); font-weight: 600; opacity: 0; transition: 0.3s; height: 20px; }
        .status.active { opacity: 1; }
        
        /* --- NEON BUTTONS --- */
        .neon-wrap { position: relative; display: none; margin-top: 20px; padding: 3px; border-radius: 50px; overflow: hidden; width: fit-content; }
        .neon-wrap.blue::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient(transparent, transparent, var(--neon), var(--purple), transparent, transparent); animation: rotate 2s linear infinite; z-index: 0; }
        .neon-wrap.red { margin-top: 20px; }
        .neon-wrap.red::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient(transparent, transparent, var(--red), #ff5500, transparent, transparent); animation: rotate 2s linear infinite; z-index: 0; }
        
        .btn-inner { position: relative; display: block; text-decoration: none; text-align: center; color: white; background: #000; padding: 12px 30px; border-radius: 48px; font-weight: 900; font-size: 14px; z-index: 1; cursor: pointer; border: none; }
    </style>
</head>
<body>

    <div class="stage" id="stage">
        <div class="led-ring"></div>
        <div class="viewport" id="vp">
            <video id="v" muted playsinline loop></video>
            <img id="o">
        </div>
    </div>

    <div class="ui" id="uiPanel">
        <button class="btn-upload" id="upBtn" onclick="document.getElementById('f').click()">UPLOAD YOUR VIDEO</button>
        <input type="file" id="f" accept="video/*" style="display:none">

        <div class="label-row"><span>ZOOM / SCALE</span><span id="zv">100%</span></div>
        <input type="range" id="zoom" min="100" max="300" step="1" value="100">

        <div class="label-row"><span>PLAYBACK SPEED</span><span id="sv">1.0x</span></div>
        <input type="range" id="speed" min="0.5" max="3.0" step="0.1" value="1.0">

        <button id="go" class="btn-go">⚡ CREATE HD GIF</button>
        
        <div id="msg" class="status">Processing...</div>
        
        <div id="dlBox" class="neon-wrap blue">
            <a id="dl" class="btn-inner">⬇️ DOWNLOAD GIF</a>
        </div>

        <div id="resetBox" class="neon-wrap red">
            <button class="btn-inner" onclick="location.reload()">↻ RESET PROJECT</button>
        </div>
    </div>

    <script>
        const workerBlob = new Blob([`importScripts('https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js');`], { type: 'application/javascript' });
        const workerUrl = URL.createObjectURL(workerBlob);

        const f = document.getElementById('f'), upBtn = document.getElementById('upBtn'), v = document.getElementById('v'), o = document.getElementById('o'), vp = document.getElementById('vp');
        const speed = document.getElementById('speed'), sv = document.getElementById('sv'), zoom = document.getElementById('zoom'), zv = document.getElementById('zv'), go = document.getElementById('go'), msg = document.getElementById('msg');
        const dlBox = document.getElementById('dlBox'), dl = document.getElementById('dl'), resetBox = document.getElementById('resetBox');

        let isDragging = false, startX, startY, startLeft, startTop, naturalW = 0, naturalH = 0;

        f.onchange = (e) => {
            const file = e.target.files[0]; if (!file) return;
            v.style.display = 'block'; o.style.display = 'none'; dlBox.style.display = 'none'; resetBox.style.display = 'none';
            v.src = URL.createObjectURL(file); v.playbackRate = parseFloat(speed.value);
            v.onloadedmetadata = () => {
                naturalW = v.videoWidth; naturalH = v.videoHeight;
                const aspect = naturalW / naturalH; v.style.left = '0px'; v.style.top = '0px';
                if (aspect > 1) { v.style.height = '320px'; v.style.width = (320 * aspect) + 'px'; } 
                else { v.style.width = '320px'; v.style.height = (320 / aspect) + 'px'; }
                v.play();
            };
        };

        zoom.oninput = () => { if(!v.src) return; zv.innerText = zoom.value + '%'; const z = parseInt(zoom.value) / 100; const aspect = naturalW / naturalH; let bW, bH; if (aspect > 1) { bH = 320; bW = 320 * aspect; } else { bW = 320; bH = 320 / aspect; } v.style.width = (bW * z) + 'px'; v.style.height = (bH * z) + 'px'; };
        const sD = (x, y) => { if(!v.src) return; isDragging = true; startX = x; startY = y; startLeft = parseFloat(v.style.left || 0); startTop = parseFloat(v.style.top || 0); vp.style.cursor = 'grabbing'; };
        const dD = (x, y) => { if (!isDragging) return; const dx = x - startX, dy = y - startY; let nL = startLeft + dx, nT = startTop + dy; const vw = parseFloat(v.style.width), vh = parseFloat(v.style.height); if (nL > 0) nL = 0; if (nL < -(vw - 320)) nL = -(vw - 320); if (nT > 0) nT = 0; if (nT < -(vh - 320)) nT = -(vh - 320); v.style.left = nL + 'px'; v.style.top = nT + 'px'; };
        vp.onmousedown = e => sD(e.pageX, e.pageY); window.onmousemove = e => dD(e.pageX, e.pageY); window.onmouseup = () => { isDragging = false; vp.style.cursor = 'move'; };
        vp.ontouchstart = e => sD(e.touches[0].pageX, e.touches[0].pageY); window.ontouchmove = e => { if(isDragging) dD(e.touches[0].pageX, e.touches[0].pageY); }; window.ontouchend = () => { isDragging = false; };

        speed.oninput = () => { sv.innerText = speed.value + 'x'; if(v.src) v.playbackRate = parseFloat(speed.value); };

        go.onclick = () => {
            if(!v.src) return; 
            // LOCK ALL UI & TURN GRAY
            go.disabled = true; upBtn.disabled = true; zoom.disabled = true; speed.disabled = true;
            msg.innerText = "Processing..."; msg.classList.add('active');
            
            const gif = new GIF({ workers: 2, quality: 10, width: 480, height: 480, workerScript: workerUrl, transparent: 0x000000 });
            const canvas = document.createElement('canvas'); canvas.width = 480; canvas.height = 480; const ctx = canvas.getContext('2d');
            const fps = 24, duration = v.duration, playbackSpeed = parseFloat(speed.value), capVid = document.createElement('video');
            capVid.src = v.src; capVid.muted = true; capVid.playsInline = true;
            capVid.onloadeddata = () => {
                const cW = parseFloat(v.style.width), cH = parseFloat(v.style.height), cL = Math.abs(parseFloat(v.style.left || 0)), cT = Math.abs(parseFloat(v.style.top || 0)), rW = naturalW / cW, rH = naturalH / cH, sx = cL * rW, sy = cT * rH, sw = 320 * rW, sh = 320 * rH;
                let cTime = 0; const captureFrame = () => { if (cTime >= duration) { msg.innerText = "Encoding..."; gif.render(); return; } capVid.currentTime = cTime; };
                capVid.onseeked = () => { ctx.drawImage(capVid, sx, sy, sw, sh, 0, 0, 480, 480); gif.addFrame(ctx, {copy: true, delay: (1000 / fps) / playbackSpeed}); cTime += (1 / fps); captureFrame(); };
                captureFrame();
            };
            gif.on('finished', (blob) => {
                const url = URL.createObjectURL(blob), rNum = Math.floor(Math.random() * 90000) + 10000;
                v.style.display = 'none'; o.src = url; o.style.display = 'block';
                dl.download = `neon_focus_${rNum}.gif`; dl.href = url;
                dlBox.style.display = 'inline-block'; resetBox.style.display = 'inline-block';
                msg.classList.remove('active'); go.style.display = 'none'; // Only hide button AFTER results appear
            });
        };
    </script>
</body>
</html>
